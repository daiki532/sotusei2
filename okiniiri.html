<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>お気に入りレシピ</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background-color: #f8f8f8;
        }

        header {
            background-color: #f4f4f4;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .breadcrumb {
            font-size: 0.9em;
            margin-right: 20px;
        }

        h1 {
            font-size: 1.8em;
            margin: 0;
        }

        main {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        #favoritesList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .favorite-recipe-item {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .favorite-recipe-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .recipe-info {
            flex-grow: 1;
        }

        .favorite-recipe-title {
            font-weight: bold;
            color: #007BFF;
            text-decoration: none;
            display: block;
            margin-bottom: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .favorite-recipe-title:hover {
            text-decoration: underline;
        }

        /* 削除ボタン */
        .delete-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: #ff4500;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 0.8em;
            z-index: 10;
        }

        .delete-btn:hover {
            background-color: #cc3700;
        }
    </style>
</head>

<body>
    <header>
        <div class="breadcrumb"><a href="home.html">ホーム</a> > お気に入り</div>
        <h1>お気に入りレシピ</h1>
    </header>

    <main>
        <div id="favoritesList"></div>
    </main>

    <script>
        const FAVORITES_KEY = "recipeFavorites"; // category.htmlで設定したキー

        // ローカルストレージからお気に入りデータを取得
        function getFavorites() {
            try {
                const favorites = localStorage.getItem(FAVORITES_KEY);
                return favorites ? JSON.parse(favorites) : {};
            } catch (e) {
                console.error("ローカルストレージからの読み込みエラー:", e);
                return {};
            }
        }

        // ローカルストレージにお気に入りデータを保存
        function saveFavorites(favorites) {
            try {
                localStorage.setItem(FAVORITES_KEY, JSON.stringify(favorites));
            } catch (e) {
                console.error("ローカルストレージへの書き込みエラー:", e);
            }
        }

        // お気に入りからレシピを削除する関数
        function deleteFavorite(recipeId) {
            let favorites = getFavorites();
            const recipeTitle = favorites[recipeId] ? favorites[recipeId].recipeTitle : 'このレシピ';

            if (confirm(`${recipeTitle}をお気に入りから削除してもよろしいですか？`)) {
                delete favorites[recipeId];
                saveFavorites(favorites);
                renderFavorites(); // 再描画
                alert("削除しました。");
            }
        }

        // お気に入りリストをレンダリング
        function renderFavorites() {
            const favorites = getFavorites();
            const favoritesListDiv = document.getElementById("favoritesList");
            const recipeItems = Object.keys(favorites).map(key => ({ id: key, ...favorites[key] }));

            if (recipeItems.length === 0) {
                favoritesListDiv.innerHTML = "<p style='text-align: center;'>お気に入りに登録されているレシピはありません。</p>";
                return;
            }

            favoritesListDiv.innerHTML = ""; // リストをクリア
            recipeItems.forEach(r => {
                const div = document.createElement("div");
                div.className = "favorite-recipe-item";
                // target="_blank"で新しいタブでレシピを開く
                div.innerHTML = `
                    <button class="delete-btn" onclick="deleteFavorite('${r.id}')">削除</button>
                    <img src="${r.foodImageUrl}" alt="${r.recipeTitle}">
                    <div class="recipe-info">
                        <a class="favorite-recipe-title" href="${r.recipeUrl}" target="_blank" title="${r.recipeTitle}">${r.recipeTitle}</a>
                    </div>`;
                favoritesListDiv.appendChild(div);
            });
        }

        // ページロード時にお気に入りを表示
        document.addEventListener("DOMContentLoaded", renderFavorites);
    </script>
</body>

</html>